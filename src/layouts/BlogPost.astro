---
import Layout from "./Layout.astro";
import { Image } from "astro:assets";
import CategorySticker from "../components/CategorySticker.astro";
import FloatingNavbar from "../components/FloatingNavbar.astro";
import Breadcrumbs from "../components/Breadcrumbs.astro";
import TableOfContents from "../components/TableOfContents.astro";
import SocialShare from "../components/SocialShare.astro";

export interface Props {
    frontmatter: {
        title: string;
        description: string;
        date: Date;
        category: string;
        image?: string;
    };
    headings?: any[];
    content?: string;
}

const { frontmatter, headings = [], content = "" } = Astro.props;

// Calcular tiempo de lectura (promedio de 200 palabras por minuto)
const words = content.split(/\s+/).length;
const readingTime = Math.ceil(words / 200);
// Normalizar fecha a objeto Date
const postDate =
    frontmatter.date instanceof Date
        ? frontmatter.date
        : new Date(frontmatter.date);
---

<Layout
    title={frontmatter.title}
    description={frontmatter.description}
    image={frontmatter.image}
    category={frontmatter.category}
    publishDate={postDate}
    type="article"
>
    <FloatingNavbar />

    <article
        class="prose prose-lg dark:prose-invert max-w-none prose-headings:font-heading prose-p:font-body"
    >
        <Breadcrumbs
            items={[
                { label: "Blog", href: "/blog" },
                { label: frontmatter.title },
            ]}
        />

        <div class="mb-10 border-b border-black/5 dark:border-white/5 pb-8">
            <CategorySticker category={frontmatter.category} />
            <h1 class="mb-4 text-4xl md:text-5xl font-bold">
                {frontmatter.title}
            </h1>
            <div class="text-stone-500 dark:text-stone-400 text-sm font-mono">
                <time datetime={postDate.toISOString()}>
                    {
                        postDate.toLocaleDateString("es-ES", {
                            dateStyle: "long",
                            timeZone: "UTC",
                        })
                    }
                </time>
                <span class="mx-2">â€¢</span>
                <span>{readingTime} min de lectura</span>
            </div>
        </div>

        {
            frontmatter.image &&
                (typeof frontmatter.image === "string" ? (
                    <img
                        src={frontmatter.image}
                        alt={frontmatter.title}
                        class="w-full h-auto rounded-3xl shadow-lg mb-8"
                    />
                ) : (
                    <Image
                        src={frontmatter.image}
                        alt={frontmatter.title}
                        class="w-full h-auto rounded-3xl shadow-lg mb-8"
                    />
                ))
        }

        <TableOfContents headings={headings} />

        <div class="mt-8">
            <slot />
        </div>

        <SocialShare
            title={frontmatter.title}
            url={new URL(Astro.url.pathname, Astro.site).toString()}
        />
    </article>
</Layout>
